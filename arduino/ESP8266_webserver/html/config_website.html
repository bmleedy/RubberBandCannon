<!DOCTYPE html>
<html>
  <head>
    <style>
    input {
      width: 120px;
      height: 20px;
    }
    </style>
    <link rel="icon" type="image/png" href="https://s3-us-west-2.amazonaws.com/rubberbandcannon/Cannon_icon_64.png">
    <title>Rubber Band Cannon Setup Page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <body>
    <img src="https://cdn.pixabay.com/photo/2014/10/03/17/16/gear-472006_1280.jpg" height="150" alt="gears image">
    <br>
    <h1>Network Status</h1>
      <ul>
        <li>SSID: <span class="ssid__"></span></li>
        <li>Connected?  <span class="conctd"></span></li>
        <li>IP Address: <span class="ipaddr"></span></li>
        <li>MAC Address: <span class="macadr"></span></li>
        <li>Port: <span class="port__"></span></li>
        <li>Link to targeting page: http://<span class="ipaddr"></span>:<span class="port__"></span></li>
        <li><input type="button" onclick="fetchNetworks()" value="Fetch Networks">
            <p id="network_list">Click "Fetch Networks" to fill this list.</p>
        </li>
      </ul>
    <h1>Network Setup</h1>
      <ul>
        <li>New WiFi SSID:<input class="ssid__" id="ssid_box" type="text" size="15">
                          <input type="button" onclick="submit('ssid')" value="Submit">
        </li>
        <li>Set WiFi Password:<input id="paswrd_box" type="password" size="15">
                              <input type="button" onclick="submit('password')" value="Submit">
        </li>
      </ul>
    <h1>Serial Ports</h1>
      <ul>
        <li>New Debug Serial Baud:  <select class="dbg_bd">
                                      <option value="57600">57600</option>
                                      <option value="38400">38400</option>
                                      <option value="19200">19200</option>
                                      <option value="9600">9600</option>
                                      <option value="4800">4800</option>
	                            </select>
                                    <input type="button" onclick="submit('debug_serial')" value="Submit">
        </li> 
        <li>New ESP Serial Baud:  <select class="esp_bd">
                                    <option value="57600">57600</option>
                                    <option value="38400">38400</option>
                                    <option value="19200">19200</option>
                                    <option value="9600" >9600</option>
                                    <option value="4800" >4800</option>
                                  </select> 
                                  <input type="button" onclick="submit('esp_serial')" value="Submit">
        </li>
      </ul>
    <h1>Appearance</h1>
      <ul>
        <li>Targeting page image:<textarea class="tgt_im" rows="1" cols="80">#{tgt_im}</textarea><br>
                                 <input type="button" onclick="submit('targeting_image')" value="Submit">
        </li>
        <li>Config page image: <textarea class="confim" rows="1" cols="80">#{confim}</textarea><br>
                               <input type="button" onclick="submit('config_image')" value="Submit">
        </li>
      </ul>
  </body>
  <footer>
    <script language="javascript">
      var prefetch_data = {
//FETCHDATA_START
//      all data between the quad_slashes and "//END" will be replaced with a callback to fill the output queue with prefetch data.
//      Fake data for testing - insert prefetch data here
                           ssid__:"leedy",
                           conctd:true,
                           ipaddr:"192.168.1.25",
                           macadr:"DE:AD:BE:EF:AB:BA",
                           port__:8080,
                           tgt_im:"https://s3-us-west-2.amazonaws.com/rubberbandcannon/rubberband.jpg",
                           confim:"https://cdn.pixabay.com/photo/2014/10/03/17/16/gear-472006_1280.jpg",
                           dbg_bd:"19200",
                           esp_bd:"9600"
//    example generated data:
//    const char config_website_text_0 PROGMEM = "<section above this comment>"
//    const char PROGMEM config_website_prefetch[][7] = {"ssid__","concd","ipaddr",
//                                                       "macaddr","port__","tgt_im",
//                                                       "confim","dbg_bd","esp_bd");
//    const int  config_website_prefetch_len = 9;  //number of strings to prefetch
//    const char config_website_text_1 PROGMEM = "<section below this comment>"
//FETCHDATA_END
      };
//    //change content or values for tags with prefetch classes
      function render_prefetch(key,value){
        console.log("prefetch called with name " + key);
        fieldstofill = document.getElementsByClassName(key);
        for (var i=0; i < fieldstofill.length; i++){
          if(fieldstofill[i].tagName.toLowerCase() == "span" ){
            fieldstofill[i].textContent = value;
          } else {
            fieldstofill[i].value = value;
          }
        }
      }
//    //For each prefetched data element, render it into the page
      keys = Object.keys(prefetch_data);
      for(var i=0; i < keys.length; i++){
        render_prefetch(keys[i],prefetch_data[keys[i]]); 
      }
//    // Callback to fetch network list from the ESP8266
      function fetchNetworks(myarg) {
        geturl = window.location;
        var baseUrl = geturl.protocol + "//" + geturl.host + "/status/networks";
        $.get(baseUrl);
      }
    </script>
  </footer>
</html>
